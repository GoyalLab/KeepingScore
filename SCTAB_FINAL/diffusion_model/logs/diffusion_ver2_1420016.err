INFO:__main__:Using GPUs: 1
INFO:__main__:Loading embeddings...
INFO:__main__:Training samples: 15240192, Validation: 3500032
INFO:__main__:Number of classes: 164
INFO:__main__:Embedding dimension: 128
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
HPU available: False, using: 0 HPUs
INFO:__main__:Running LR finder...
Missing logger folder: tb_logs/conditional_diffusion
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Finding best initial lr:   0%|          | 0/100 [00:00<?, ?it/s]Finding best initial lr:   1%|          | 1/100 [00:00<01:12,  1.37it/s]Finding best initial lr:   8%|▊         | 8/100 [00:00<00:07, 12.36it/s]Finding best initial lr:  12%|█▏        | 12/100 [00:01<00:06, 13.65it/s]Finding best initial lr:  18%|█▊        | 18/100 [00:01<00:03, 21.00it/s]Finding best initial lr:  23%|██▎       | 23/100 [00:01<00:02, 26.24it/s]Finding best initial lr:  29%|██▉       | 29/100 [00:01<00:02, 32.87it/s]Finding best initial lr:  35%|███▌      | 35/100 [00:01<00:01, 38.38it/s]Finding best initial lr:  41%|████      | 41/100 [00:01<00:01, 43.14it/s]Finding best initial lr:  47%|████▋     | 47/100 [00:01<00:01, 46.82it/s]Finding best initial lr:  53%|█████▎    | 53/100 [00:01<00:00, 50.09it/s]Finding best initial lr:  59%|█████▉    | 59/100 [00:02<00:01, 35.86it/s]Finding best initial lr:  65%|██████▌   | 65/100 [00:02<00:00, 40.63it/s]Finding best initial lr:  71%|███████   | 71/100 [00:02<00:00, 44.99it/s]Finding best initial lr:  78%|███████▊  | 78/100 [00:02<00:00, 49.26it/s]Finding best initial lr:  85%|████████▌ | 85/100 [00:02<00:00, 52.44it/s]Finding best initial lr:  92%|█████████▏| 92/100 [00:02<00:00, 36.92it/s]Finding best initial lr:  99%|█████████▉| 99/100 [00:02<00:00, 42.14it/s]`Trainer.fit` stopped: `max_steps=100` reached.
Finding best initial lr: 100%|██████████| 100/100 [00:02<00:00, 33.37it/s]
Learning rate set to 0.0019054607179632462
Restoring states from the checkpoint path at /gpfs/projects/b1042/GoyalLab/jaekj/SCTAB_FINAL/diffusion_model/.lr_find_2998ae24-01c5-4cba-8be5-d0fdc60319e6.ckpt
/projects/b1042/GoyalLab/jaekj/python/scTAB/lib/python3.8/site-packages/lightning/fabric/utilities/cloud_io.py:57: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
Restored all states from the checkpoint at /gpfs/projects/b1042/GoyalLab/jaekj/SCTAB_FINAL/diffusion_model/.lr_find_2998ae24-01c5-4cba-8be5-d0fdc60319e6.ckpt
INFO:__main__:Keeping original learning rate 0.0003
INFO:__main__:Starting training...
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]

  | Name  | Type                | Params | Mode 
------------------------------------------------------
0 | model | ConditionalDenoiser | 737 K  | train
------------------------------------------------------
737 K     Trainable params
0         Non-trainable params
737 K     Total params
2.949     Total estimated model params size (MB)
SLURM auto-requeueing enabled. Setting signal handlers.
/projects/b1042/GoyalLab/jaekj/python/scTAB/lib/python3.8/site-packages/umap/umap_.py:1945: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(f"n_jobs value {self.n_jobs} overridden to 1 by setting random_state. Use no seed for parallelism.")
/projects/b1042/GoyalLab/jaekj/python/scTAB/lib/python3.8/site-packages/umap/umap_.py:1945: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(f"n_jobs value {self.n_jobs} overridden to 1 by setting random_state. Use no seed for parallelism.")
Metric val_loss improved. New best score: 0.261
Metric val_loss improved by 0.009 >= min_delta = 0.0. New best score: 0.253
Metric val_loss improved by 0.007 >= min_delta = 0.0. New best score: 0.246
Metric val_loss improved by 0.003 >= min_delta = 0.0. New best score: 0.244
Metric val_loss improved by 0.004 >= min_delta = 0.0. New best score: 0.239
Metric val_loss improved by 0.000 >= min_delta = 0.0. New best score: 0.239
Metric val_loss improved by 0.003 >= min_delta = 0.0. New best score: 0.236
Metric val_loss improved by 0.004 >= min_delta = 0.0. New best score: 0.231
Metric val_loss improved by 0.001 >= min_delta = 0.0. New best score: 0.230
Metric val_loss improved by 0.002 >= min_delta = 0.0. New best score: 0.228
Metric val_loss improved by 0.003 >= min_delta = 0.0. New best score: 0.224
Metric val_loss improved by 0.001 >= min_delta = 0.0. New best score: 0.223
Metric val_loss improved by 0.002 >= min_delta = 0.0. New best score: 0.222
Metric val_loss improved by 0.001 >= min_delta = 0.0. New best score: 0.221
Metric val_loss improved by 0.000 >= min_delta = 0.0. New best score: 0.221
Metric val_loss improved by 0.001 >= min_delta = 0.0. New best score: 0.220
Metric val_loss improved by 0.000 >= min_delta = 0.0. New best score: 0.220
Metric val_loss improved by 0.002 >= min_delta = 0.0. New best score: 0.218
Metric val_loss improved by 0.002 >= min_delta = 0.0. New best score: 0.216
Metric val_loss improved by 0.000 >= min_delta = 0.0. New best score: 0.216
Metric val_loss improved by 0.001 >= min_delta = 0.0. New best score: 0.215
Metric val_loss improved by 0.000 >= min_delta = 0.0. New best score: 0.215
Metric val_loss improved by 0.000 >= min_delta = 0.0. New best score: 0.215
Metric val_loss improved by 0.000 >= min_delta = 0.0. New best score: 0.214
Metric val_loss improved by 0.001 >= min_delta = 0.0. New best score: 0.214
Metric val_loss improved by 0.000 >= min_delta = 0.0. New best score: 0.214
Metric val_loss improved by 0.000 >= min_delta = 0.0. New best score: 0.213
Metric val_loss improved by 0.000 >= min_delta = 0.0. New best score: 0.213
Metric val_loss improved by 0.001 >= min_delta = 0.0. New best score: 0.212
/projects/b1042/GoyalLab/jaekj/python/scTAB/lib/python3.8/site-packages/umap/umap_.py:1945: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(f"n_jobs value {self.n_jobs} overridden to 1 by setting random_state. Use no seed for parallelism.")
Metric val_loss improved by 0.000 >= min_delta = 0.0. New best score: 0.212
Metric val_loss improved by 0.000 >= min_delta = 0.0. New best score: 0.212
Metric val_loss improved by 0.000 >= min_delta = 0.0. New best score: 0.212
Metric val_loss improved by 0.000 >= min_delta = 0.0. New best score: 0.211
Metric val_loss improved by 0.001 >= min_delta = 0.0. New best score: 0.210
Metric val_loss improved by 0.000 >= min_delta = 0.0. New best score: 0.210
Metric val_loss improved by 0.001 >= min_delta = 0.0. New best score: 0.209
Metric val_loss improved by 0.000 >= min_delta = 0.0. New best score: 0.209
Metric val_loss improved by 0.000 >= min_delta = 0.0. New best score: 0.209
/projects/b1042/GoyalLab/jaekj/python/scTAB/lib/python3.8/site-packages/umap/umap_.py:1945: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(f"n_jobs value {self.n_jobs} overridden to 1 by setting random_state. Use no seed for parallelism.")
Metric val_loss improved by 0.000 >= min_delta = 0.0. New best score: 0.209
Metric val_loss improved by 0.000 >= min_delta = 0.0. New best score: 0.209
Metric val_loss improved by 0.000 >= min_delta = 0.0. New best score: 0.208
Metric val_loss improved by 0.001 >= min_delta = 0.0. New best score: 0.208
Metric val_loss improved by 0.000 >= min_delta = 0.0. New best score: 0.208
Metric val_loss improved by 0.000 >= min_delta = 0.0. New best score: 0.208
Metric val_loss improved by 0.001 >= min_delta = 0.0. New best score: 0.207
/projects/b1042/GoyalLab/jaekj/python/scTAB/lib/python3.8/site-packages/umap/umap_.py:1945: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(f"n_jobs value {self.n_jobs} overridden to 1 by setting random_state. Use no seed for parallelism.")
Monitored metric val_loss did not improve in the last 25 records. Best score: 0.207. Signaling Trainer to stop.
INFO:__main__:Training completed.
INFO:__main__:Model saved to /projects/b1042/GoyalLab/jaekj/SCTAB_FINAL/diffusion_model/state/diffusion_module_final.pt
